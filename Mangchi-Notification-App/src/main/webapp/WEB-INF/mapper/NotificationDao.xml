<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mangchi.subscribe.dao.NotificationDao">

	<resultMap type="com.mangchi.subscribe.model.Notification" id="resultFcm">
		<id property="noticeIdx" column="notice_idx"/>
		<result property="memberNick" column="member_nick"/>		
		<result property="token" column="notice_token"/>
		<result property="keyword" column="notice_keyword"/>
		<result property="regdate" column="notice_regdate"/>
	</resultMap>

	<resultMap type="com.mangchi.subscribe.model.Subscribe" id="resultSubscribe">
		<id property="subscribeIdx" column="subscribe_idx"/>
		<result property="memberNick" column="member_nick"/>		
		<result property="token" column="subscribe_token"/>
		<result property="regdate" column="subscribe_regdate"/>
	</resultMap>

	<!-- 키워드 관리 -->
	<!-- 키워드 등록 -->
	<insert id="insertKeyword"
			parameterType="com.mangchi.subscribe.model.Notification"
			useGeneratedKeys="true"
			keyProperty="noticeIdx">
		insert into Mangchi.donate_notification (member_nick, notice_token, notice_keyword)
		value (#{memberNick}, #{token}, #{keyword})
	</insert>
	
	<!-- 키워드 리스트 -->
	<select id="selectKeyByMember"
			resultMap="resultFcm">
		select * from Mangchi.donate_notification
		where member_nick=#{memberNick}
	
	</select>
	
	<!-- 키워드 존재 여부 검사 -->
	<select id="selectKeyword"
			resultMap="resultFcm"
			resultType="String">
		select notice_keyword from Mangchi.donate_notification
		where member_nick=#{memberNick}
	</select>
	
	
	<!-- 키워드 삭제 -->
	<delete id="deleteKeyword">
		delete from Mangchi.donate_notification where notice_idx=#{noticeIdx}
	</delete>
	
	
	
	<!-- 구독 관리 -->
	<!-- 구독 등록 -->
	<insert id="regSubscriber">
		insert into Mangchi.donate_subscribe (member_nick, subscribe_token)
		values (#{memberNick}, #{token})
	</insert>
	
	<!-- 구독자 검사 -->
	<select id="countTrue">
		select count(*) from Mangchi.donate_subscribe where member_nick=#{memberNick}
	</select>
	
	<!-- 구독 취소 -->
	<delete id="deleteSubscribe">
		delete from Mangchi.donate_subscribe where member_nick=#{memberNick}
	</delete>
	
	<!-- 사용자가 구독자인지 검사 -->
	<select id="countCheckSubsribe">
		select count(*) from Mangchi.donate_subscribe where member_nick=#{memberNick}
	</select>
	

</mapper>